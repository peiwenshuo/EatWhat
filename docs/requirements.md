# 需求文档 - 情侣饮食健身助手

## 项目概述

一个专为情侣设计的智能饮食计划和健身追踪应用，帮助两人一起健康生活、记录美好时光。

## 核心需求

### 1. 用户系统
- **双用户模式**: 支持 2 个独立账号
- **认证方式**: 
  - 邮箱 + 密码
  - Google OAuth（可选）
- **用户资料**:
  - 基本信息：姓名、头像、身高、体重、年龄、性别
  - 健身目标：减脂/增肌/维持
  - TDEE 和目标卡路里自动计算
- **伴侣绑定**: 两个账号可以绑定为伴侣关系

### 2. AI 饮食规划
- **智能菜单生成**:
  - 按需生成（不自动调用 API）
  - 一周七天 x 三餐（早午晚）
  - 可单独重新生成某一天或某一餐
- **个性化参数**:
  - 卡路里目标
  - 饮食类型（均衡/生酮/素食等）
  - 过敏原和忌口
  - 烹饪难度偏好
  - 预算范围
- **冰箱优先**:
  - 优先使用现有食材生成菜单
  - 减少浪费

### 3. 食谱系统
- **食谱来源**:
  - AI 生成食谱
  - 用户手动添加食谱
  - 可编辑 AI 生成的食谱
- **食谱内容**:
  - 菜名、图片、描述
  - 食材清单（名称、用量、单位）
  - 烹饪步骤
  - 营养信息（参考值）：卡路里、蛋白质、碳水、脂肪
  - 烹饪时间、难度、份量
- **互动功能**:
  - 评分和评论
  - 个人笔记（"下次少放盐"）
  - 收藏夹
  - 标记"已做过"
- **份量调整**:
  - 1人份 / 2人份切换
  - 自动换算食材用量

### 4. 饮食记录
- **记录方式**:
  - 手动输入
  - 语音输入（可选）
  - 拍照上传（可选 AI 识别）
- **记录内容**:
  - 日期、时间、餐次
  - 食物名称、份量
  - 营养信息（参考值）
  - 照片（可选）
  - 备注
- **快捷记录**:
  - 常吃食物快捷按钮
  - 模板功能（保存常吃组合）
- **互动**:
  - 对方可点赞、评论

### 5. 冰箱食材管理
- **食材库存**:
  - 添加、编辑、删除食材
  - 记录数量、单位、分类
  - 过期日期
- **过期提醒**:
  - 自动提醒快过期食材
- **智能建议**:
  - "用这些食材能做什么？"

### 6. 采购清单
- **自动生成**:
  - 基于本周菜单自动生成
  - 合并重复食材
  - 按超市分区分类
- **双人合并**:
  - 合并两人的采购需求
  - 避免重复购买
- **采购管理**:
  - 勾选已购买
  - 记录花费
  - 每周/每月预算统计
- **预算功能**:
  - 设置每月预算
  - 超支提醒
  - 花费趋势分析

### 7. 健身记录
- **运动类型**:
  - 有氧（跑步、游泳、骑行）
  - 力量训练（按部位）
  - 瑜伽/拉伸
  - 日常活动
- **记录内容**:
  - 日期、运动类型、名称
  - 时长、消耗卡路里
  - 照片、备注
- **体重追踪**:
  - 每日/每周称重
  - 体脂率、围度
  - 对比照片（可选）
  - 趋势图表

### 8. 情侣互动 ❤️
- **实时聊天**:
  - 内置私聊室
  - 发送文字、照片、表情
  - 分享食谱链接
- **共享视图**:
  - 查看对方今日饮食
  - 并排显示双人菜单
  - 标记"一起吃"的餐次
- **任务系统**:
  - "今天谁做饭"轮换
  - 做饭打卡 + 拍照
  - 对方评分和评论
- **共同目标**:
  - 设置情侣挑战（"一起瘦10斤"）
  - 进度可视化对比
  - 达成庆祝
- **互相监督**:
  - "TA 今天还没运动"提醒
  - 互相点赞鼓励
- **纪念日**:
  - "第一次一起做饭"
  - "连续打卡 100 天"
  - 成就勋章

### 9. 数据统计
- **个人数据**:
  - 每日卡路里摄入 vs 目标
  - 营养素分布（蛋白质/碳水/脂肪）
  - 运动消耗统计
  - 体重变化曲线
- **对比视图**:
  - 双人数据并排对比
  - 共同进度展示
- **报表生成**:
  - 周报、月报
  - PDF 导出（可选）

### 10. AI 助手
- **对话场景**:
  - "今天吃什么？"
  - "这道菜怎么做？"
  - "我想减5kg，给我建议"
  - "帮我看看今天营养够不够"
- **上下文记忆**:
  - 记住历史偏好
  - 关联用户数据
- **API 调用控制**:
  - 用户主动触发
  - 可配置调用上限

### 11. PWA 特性
- **应用化**:
  - 添加到主屏幕
  - 全屏模式
- **离线功能**:
  - 基础页面离线可用
  - 本地缓存
- **通知**:
  - Web Push 推送
  - 吃饭、运动、喝水提醒
  - 食材过期提醒

## 技术要求

### API 调用策略
- OpenAI API 按需调用，不自动触发
- 可设置每日/每周调用上限
- 优化 Prompt 减少 Token 消耗

### 数据存储
- PostgreSQL 存储结构化数据
- Vercel Blob 存储图片
- Supabase Realtime 实现聊天

### 性能优化
- 图片懒加载
- 数据分页加载
- 合理的缓存策略

### 安全性
- 用户数据加密
- API Key 安全管理
- XSS、SQL 注入防护

## MVP 开发阶段

### Phase 1: 基础框架（第 1-2 周）
- [x] Next.js 项目初始化
- [x] Tailwind + shadcn/ui 配置
- [ ] Prisma 数据库配置
- [ ] NextAuth 认证系统
- [ ] PWA 配置
- [ ] 基础页面布局

### Phase 2: 核心饮食功能（第 2-3 周）
- [ ] OpenAI API 集成
- [ ] AI 生成每周菜单
- [ ] 食谱详情页
- [ ] 手动添加食谱
- [ ] 饮食记录
- [ ] 今日统计

### Phase 3: 冰箱和采购（第 3-4 周）
- [ ] 冰箱食材管理
- [ ] 过期提醒
- [ ] 采购清单生成
- [ ] 双人采购合并
- [ ] 花费记录

### Phase 4: 健身追踪（第 4-5 周）
- [ ] 运动记录
- [ ] 体重追踪
- [ ] 数据可视化
- [ ] 周报/月报

### Phase 5: 情侣互动（第 5-6 周）
- [ ] 实时聊天
- [ ] 共享菜单视图
- [ ] 做饭打卡
- [ ] 点赞评论

### Phase 6: AI 助手和优化（第 6-7 周）
- [ ] AI 对话界面
- [ ] 场景化提示词
- [ ] 性能优化
- [ ] 移动端适配

### Phase 7: 高级功能（第 7-8 周）
- [ ] 共同目标系统
- [ ] 成就勋章
- [ ] Web Push 通知
- [ ] 数据导出

## 注意事项

1. **架构清晰**: 代码分层明确，组件可复用
2. **文档同步**: 每次功能开发都更新文档
3. **测试优先**: 核心功能必须有测试覆盖
4. **用户体验**: 操作简洁直观，反馈及时
5. **性能优先**: 页面加载快，交互流畅

## 参考资源

- Next.js 文档: https://nextjs.org/docs
- shadcn/ui: https://ui.shadcn.com
- Prisma: https://www.prisma.io/docs
- OpenAI API: https://platform.openai.com/docs
